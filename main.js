(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(t,r,n){return(r=function(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}var o={authorization:"90f0197a-2479-4135-bf17-f0596cbee6c6","Content-Type":"application/json"};function c(e,t){var n="".concat("https://mesto.nomoreparties.co/v1","/").concat("wff-cohort-41").concat(e);return fetch(n,r(r({},t),{},{headers:r(r({},o),t.headers)})).then((function(e){if(e.ok)return e.json();var t=new Error("Ошибка HTTP: ".concat(e.status));return t.response=e,Promise.reject(t)}))}function u(){return c("/users/me",{method:"GET"})}function i(e,t,r,n,o){var c=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),u=c.querySelector(".card__image"),i=c.querySelector(".card__title"),a=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-counter");return u.src=e.link,u.alt=e.name,i.textContent=e.name,!(o&&e.owner._id===o._id)&&a&&a.remove(),e.likes.some((function(e){return e._id===o._id}))&&l.classList.add("card__like-button_is-active"),s&&(s.textContent=e.likes.length),l.addEventListener("click",(function(){r(c,e._id,l,s)})),a&&a.addEventListener("click",(function(){t(c,e._id)})),u.addEventListener("click",(function(){n(e.link,e.name)})),c}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)}function s(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&l(t)}}function p(e){e.target.classList.contains("popup")&&l(e.target)}function d(e,t){e.addEventListener("click",(function(){l(t)}))}function f(e){return/\.(jpeg|jpg|png|webp|gif)$/i.test(e)}function m(e,t,r){Array.from(e.querySelectorAll(".popup__input")).every((function(e){return e.checkValidity()}))?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled=!0)}function y(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r.forEach((function(e){var r=document.querySelector(".".concat(e.id,"-error"));e.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent="",e.setCustomValidity("")})),n.classList.add(t.inactiveButtonClass),n.disabled=!0}var _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validators:{name:{regex:/^[а-яА-ЯёЁa-zA-Z\- ]{2,40}$/i,error:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"},description:{regex:/^[а-яА-ЯёЁa-zA-Z\- ]{2,200}$/i,error:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"},url:{regex:/^https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_+.~#?&/=]*)$/i,error:"Введите корректный URL"},image:{validator:f,error:"Введите прямую ссылку на изображение (.jpg, .png, .webp)"}},minLength:{name:2,description:2,cardName:2},maxLength:{name:40,description:200,cardName:30}};function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var b,S={},h={currentCard:null},g=document.querySelector(".places__list"),C=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),L=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__edit-avatar-button"),j=document.querySelector('.popup__form[name="edit-profile"]'),w=document.querySelector('.popup__form[name="new-place"]'),O=document.querySelector('.popup__form[name="update-avatar"]'),A=document.querySelector(".popup__input_type_name"),P=document.querySelector(".popup__input_type_description"),T=document.querySelector(".popup__input_type_card-name"),D=document.querySelector(".popup__input_type_url"),I=document.querySelector(".popup__input_type_avatar"),B=document.querySelector(".popup_type_edit"),z=document.querySelector(".popup_type_new-card"),N=document.querySelector(".popup_type_update-avatar"),V=document.querySelector(".popup_type_image"),Z=document.querySelector(".popup_type_confirm-delete"),$=document.querySelector(".popup__image"),H=document.querySelector(".popup__caption");function J(e,t,r,n,o){o.currentCard={cardElement:e,cardId:t},r(n)}function U(e,t,r,n){r.classList.contains("card__like-button_is-active")?function(e){return c("/cards/likes/".concat(e),{method:"DELETE"})}(t).then((function(e){r.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при снятии лайка:",e)})):function(e){return c("/cards/likes/".concat(e),{method:"PUT"})}(t).then((function(e){r.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при установке лайка:",e)}))}if(u().then((function(e){S=e,C.textContent=e.name,q.textContent=e.about,E.style.backgroundImage="url(".concat(e.avatar,")"),l(B)})).catch((function(e){console.error("Не удалось загрузить данные пользователя:",e)})),Z){Z.addEventListener("click",p);var G=Z.querySelector(".popup__close");G&&d(G,Z)}if(Z){var M=Z.querySelector('.popup__form[name="confirm-delete"]');M&&M.addEventListener("submit",(function(e){if(e.preventDefault(),h.currentCard){var t=h.currentCard,r=t.cardElement,n=t.cardId,o=M.querySelector(".popup__button"),u=o.textContent;o.textContent="Удаление...",o.disabled=!0,function(e){return c("/cards/".concat(e),{method:"DELETE"})}(n).then((function(){r.remove(),l(Z),h.currentCard=null})).catch((function(e){console.error("Не удалось удалить карточку:",e),alert("Ошибка при удалении карточки. Попробуйте ещё раз.")})).finally((function(){o.textContent=u,o.disabled=!1}))}}))}function R(e,t){$.src=e,$.alt=t,H.textContent=t,a(V)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",p);var t=e.querySelector(".popup__close");t&&d(t,e)})),L.addEventListener("click",(function(){A.value=C.textContent,P.value=q.textContent,a(B),y(j,_)})),j.addEventListener("submit",(function(e){e.preventDefault();var t,r=j.querySelector(".popup__button");r.textContent,r.textContent="Сохранение...",r.disabled=!0,(t={name:A.value,about:P.value},c("/users/me",{method:"PATCH",body:JSON.stringify(t)})).then((function(e){C.textContent=e.name,q.textContent=e.about,l(B)})).catch((function(e){console.error("Не удалось обновить профиль:",e),alert("Не удалось сохранить изменения. Попробуйте позже.")})).finally((function(){var e=j.querySelector(".popup__button");e.textContent="Сохранить",e.disabled=!1}))})),k.addEventListener("click",(function(){O.reset(),y(O,_),a(N)})),O.addEventListener("submit",(function(e){e.preventDefault();var t,r=O.querySelector(".popup__button"),n=r.textContent;if(!f(I.value))return I.setCustomValidity("Введите прямую ссылку на изображение (.jpg, .png, .webp)"),void I.reportValidity();r.textContent="Сохранение...",r.disabled=!0,(t=I.value,c("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:t})})).then((function(e){E.style.backgroundImage="url(".concat(e.avatar,")"),l(N),O.reset(),y(O,_)})).catch((function(e){console.error("Не удалось обновить аватар:",e)})).finally((function(){r.textContent=n,r.disabled=!1}))})),x.addEventListener("click",(function(){w.reset(),y(w,_),a(z)})),w.addEventListener("submit",(function(e){e.preventDefault();var t,r=w.querySelector(".popup__button"),n=r.textContent;r.textContent="Создание...",r.disabled=!0,(t={name:T.value,link:D.value},c("/cards",{method:"POST",body:JSON.stringify(t)})).then((function(e){var t=i(e,(function(e,t){return J(e,t,a,Z,h)}),(function(e,t,r,n){return U(0,t,r,n)}),R,S);g.prepend(t),l(z),w.reset(),y(w,_)})).catch((function(e){console.error("Не удалось добавить карточку:",e)})).finally((function(){r.textContent=n,r.disabled=!1}))})),Promise.all([u(),c("/cards",{method:"GET"})]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,u,i=[],a=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;a=!1}else for(;!(a=(n=c.call(r)).done)&&(i.push(n.value),i.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];S=o,C.textContent=o.name,q.textContent=o.about,E.style.backgroundImage="url(".concat(o.avatar,")"),c.forEach((function(e){var t=i(e,(function(e,t){return J(e,t,a,Z,h)}),(function(e,t,r,n){return U(0,t,r,n)}),R,S);g.append(t)}))})).catch((function(e){console.error("Не удалось загрузить начальные данные:",e),alert("Не удалось загрузить данные. Попробуйте позже.")})),b=_,document.querySelectorAll(b.formSelector).forEach((function(e){var t=Array.from(e.querySelectorAll(b.inputSelector)),r=e.querySelector(b.submitButtonSelector);function n(){t.forEach((function(e){return function(e,t){var r=t.validators,n=t.minLength,o=t.maxLength,c=t.inputErrorClass,u=t.errorClass,i=document.querySelector(".".concat(e.id,"-error")),a="",l=e.value.trim(),s=e.getAttribute("name");if(l){if(n[s]&&l.length<n[s])a="Минимальное количество символов: ".concat(n[s],". Сейчас: ").concat(l.length);else if(o[s]&&l.length>o[s])a="Максимальное количество символов: ".concat(o[s]);else if(r[s]){var p=r[s];(p.regex&&!p.regex.test(l)||p.validator&&!p.validator(l))&&(a=p.error)}}else a=e.dataset.errorMessage||"Вы пропустили это поле.";a?e.setCustomValidity(a):e.setCustomValidity(""),i.textContent=a,e.classList.toggle(c,!!a),i.classList.toggle(u,!!a)}(e,b)})),m(e,r,b.inactiveButtonClass)}t.forEach((function(e){e.addEventListener("input",n)})),m(e,r,b.inactiveButtonClass)}))})();